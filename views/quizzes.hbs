


<div class="content-wrapper">
    <div class="page-header">
        <div class="page-title">
            <h1>Quizzes</h1>
            <p>Manage your quizzes and questions</p>
        </div>
        <button class="btn-add-quiz" id="addQuizBtn">
            <i class="fas fa-plus"></i>
            Add Quiz
        </button>
    </div>

    <!-- Quiz Table -->
    <div class="table-responsive">
        <table class="quiz-table">
            <thead>
                <tr>
                    <th class="column-small">#</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Tags</th>
                    <th>Image</th>
                    <th>Created at</th>
                    <th>Updated</th>
                    <th>Actions</th>
                    <th>Questions</th>
                </tr>
            </thead>
            <tbody id="quizTableBody">
                <tr id="quiz-1">
                    <td>1</td>
                    <td class="quiz-title">Táo Quan</td>
                    <td class="quiz-description">ha ha</td>
                    <td class="quiz-category">Entertainment</td>
                    <td class="quiz-tags">comedy, television</td>
                    <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
                    <td>18/03/25</td>
                    <td><span class="badge-updated">2 days ago</span></td>
                    <td class="actions-cell">
                        <button class="btn-edit" data-id="1" data-title="Táo Quan" data-desc="ha ha" data-category="Entertainment" data-tags="comedy, television">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-delete" data-id="1" data-title="Táo Quan">Delete</button>
                        <button class="btn-publish" data-id="1" onclick="togglePublishStatus(1)">
                            <i class="fas fa-eye"></i>
                            <span class="publish-text">Publish</span>
                        </button>
                    </td>
                    <td>
                        <a href="/admin/quizzes/1/addquestion" class="btn-go">
                            <i class="fas fa-question-circle"></i>
                            Go
                        </a>
                    </td>
                </tr>
                <tr id="quiz-2">
                    <td>2</td>
                    <td class="quiz-title">33</td>
                    <td class="quiz-description">33</td>
                    <td class="quiz-category">Math</td>
                    <td class="quiz-tags">numbers</td>
                    <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
                    <td>18/03/25</td>
                    <td><span class="badge-updated today">Today</span></td>
                    <td class="actions-cell">
                        <button class="btn-edit" data-id="2" data-title="33" data-desc="33" data-category="Math" data-tags="numbers">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-delete" data-id="2" data-title="33">Delete</button>
                        <button class="btn-publish" data-id="2" onclick="togglePublishStatus(2)">
                            <i class="fas fa-eye"></i>
                            <span class="publish-text">Publish</span>
                        </button>
                    </td>
                    <td>
                        <a href="/admin/quizzes/2/addquestion" class="btn-go">
                            <i class="fas fa-question-circle"></i>
                            Go
                        </a>
                    </td>
                </tr>
                <tr id="quiz-3">
                    <td>3</td>
                    <td class="quiz-title">te</td>
                    <td class="quiz-description">wew</td>
                    <td class="quiz-category">General</td>
                    <td class="quiz-tags">test</td>
                    <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
                    <td>18/03/25</td>
                    <td><span class="badge-updated">10 days ago</span></td>
                    <td class="actions-cell">
                        <button class="btn-edit" data-id="3" data-title="te" data-desc="wew" data-category="General" data-tags="test">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-delete" data-id="3" data-title="te">Delete</button>
                        <button class="btn-publish" data-id="3" onclick="togglePublishStatus(3)">
                            <i class="fas fa-eye"></i>
                            <span class="publish-text">Publish</span>
                        </button>
                    </td>
                    <td>
                        <a href="/admin/quizzes/3/addquestion" class="btn-go">
                            <i class="fas fa-question-circle"></i>
                            Go
                        </a>
                    </td>
                </tr>
                <tr id="quiz-4">
                    <td>4</td>
                    <td class="quiz-title">1</td>
                    <td class="quiz-description">1</td>
                    <td class="quiz-category">Other</td>
                    <td class="quiz-tags">simple</td>
                    <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
                    <td>18/03/25</td>
                    <td><span class="badge-updated">10 days ago</span></td>
                    <td class="actions-cell">
                        <button class="btn-edit" data-id="4" data-title="1" data-desc="1" data-category="Other" data-tags="simple">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-delete" data-id="4" data-title="1">Delete</button>
                        <button class="btn-publish" data-id="4" onclick="togglePublishStatus(4)">
                            <i class="fas fa-eye"></i>
                            <span class="publish-text">Publish</span>
                        </button>
                    </td>
                    <td>
                        <a href="/admin/quizzes/4/addquestion" class="btn-go">
                            <i class="fas fa-question-circle"></i>
                            Go
                        </a>
                    </td>
                </tr>
                <tr id="quiz-5">
                    <td>5</td>
                    <td class="quiz-title">Vòng quanh thế giới</td>
                    <td class="quiz-description">chuyến đi dài</td>
                    <td class="quiz-category">Geography</td>
                    <td class="quiz-tags">travel, world</td>
                    <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
                    <td>20/03/25</td>
                    <td><span class="badge-updated">4 days ago</span></td>
                    <td class="actions-cell">
                        <button class="btn-edit" data-id="5" data-title="Vòng quanh thế giới" data-desc="chuyến đi dài" data-category="Geography" data-tags="travel, world">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-delete" data-id="5" data-title="Vòng quanh thế giới">Delete</button>
                        <button class="btn-publish" data-id="5" onclick="togglePublishStatus(5)">
                            <i class="fas fa-eye"></i>
                            <span class="publish-text">Publish</span>
                        </button>
                    </td>
                    <td>
                        <a href="/admin/quizzes/5/addquestion" class="btn-go">
                            <i class="fas fa-question-circle"></i>
                            Go
                        </a>
                    </td>
                </tr>
                <tr id="quiz-6">
                    <td>6</td>
                    <td class="quiz-title">Thế giới nayyy</td>
                    <td class="quiz-description">hia</td>
                    <td class="quiz-category">Geography</td>
                    <td class="quiz-tags">world</td>
                    <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
                    <td>20/03/25</td>
                    <td><span class="badge-updated">8 days ago</span></td>
                    <td class="actions-cell">
                        <button class="btn-edit" data-id="6" data-title="Thế giới nayyy" data-desc="hia" data-category="Geography" data-tags="world">
                            <i class="fas fa-edit"></i>
                            Edit
                        </button>
                        <button class="btn-delete" data-id="6" data-title="Thế giới nayyy">Delete</button>
                        <button class="btn-publish" data-id="6" onclick="togglePublishStatus(6)">
                            <i class="fas fa-eye"></i>
                            <span class="publish-text">Publish</span>
                        </button>
                    </td>
                    <td>
                        <a href="/admin/quizzes/6/addquestion" class="btn-go">
                            <i class="fas fa-question-circle"></i>
                            Go
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Quiz Modal -->
<div id="addQuizModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Quiz</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <form id="addQuizForm">
                <div class="form-group">
                    <label for="quizTitle">Title</label>
                    <input type="text" id="quizTitle" required>
                </div>
                <div class="form-group">
                    <label for="quizDescription">Description</label>
                    <textarea id="quizDescription" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="quizCategory">Category</label>
                    <select id="quizCategory" required>
                        <option value="">Select a category</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Math">Math</option>
                        <option value="Science">Science</option>
                        <option value="Geography">Geography</option>
                        <option value="History">History</option>
                        <option value="Sports">Sports</option>
                        <option value="Literature">Literature</option>
                        <option value="General">General</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quizTags">Tags</label>
                    <input type="text" id="quizTags" placeholder="Enter tags separated by commas">
                </div>
                <div class="form-group">
                    <label for="quizImage">Image</label>
                    <div class="image-upload-container">
                        <input type="file" id="quizImage" accept="image/*">
                        <div class="image-preview" id="imagePreview"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel">Cancel</button>
                    <button type="submit" class="btn-submit">Add Quiz</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Quiz Modal -->
<div id="editQuizModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Edit Quiz</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <form id="editQuizForm">
                <input type="hidden" id="editQuizId">
                <div class="form-group">
                    <label for="editQuizTitle">Title</label>
                    <input type="text" id="editQuizTitle" required>
                </div>
                <div class="form-group">
                    <label for="editQuizDescription">Description</label>
                    <textarea id="editQuizDescription" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="editQuizCategory">Category</label>
                    <select id="editQuizCategory" required>
                        <option value="">Select a category</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Math">Math</option>
                        <option value="Science">Science</option>
                        <option value="Geography">Geography</option>
                        <option value="History">History</option>
                        <option value="Sports">Sports</option>
                        <option value="Literature">Literature</option>
                        <option value="General">General</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editQuizTags">Tags</label>
                    <input type="text" id="editQuizTags" placeholder="Enter tags separated by commas">
                </div>
                <div class="form-group">
                    <label for="editQuizImage">Image</label>
                    <div class="image-upload-container">
                        <input type="file" id="editQuizImage" accept="image/*">
                        <div class="image-preview" id="editImagePreview">
                            <img id="currentQuizImage" src="/api/placeholder/100/100" alt="Current quiz image">
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel">Cancel</button>
                    <button type="submit" class="btn-submit">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Publish/Unpublish Modal -->
<div id="publishModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="publishModalTitle">Publish Quiz</h2>
            <span class="close" onclick="closePublishModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p id="publishConfirmMessage">Are you sure you want to publish this quiz? It will be visible to all users.</p>
            <p id="unpublishConfirmMessage" style="display:none">Are you sure you want to unpublish this quiz? It will no longer be visible to users.</p>
            
            <div class="form-actions">
                <button class="btn-cancel" onclick="closePublishModal()">Cancel</button>
                <button id="confirmPublishBtn" class="btn-submit">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Quiz Modal -->
<div id="deleteQuizModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Delete Quiz</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete the quiz "<span id="deleteQuizTitle"></span>"?</p>
            <p class="warning-text">This action cannot be undone.</p>
            <div class="form-actions">
                <button type="button" class="btn-cancel">Cancel</button>
                <button type="button" id="confirmDelete" class="btn-delete-confirm">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Success Toast Notification -->
<div id="toastNotification" class="toast">
    <div class="toast-content">
        <i class="fas fa-check-circle"></i>
        <div class="toast-message">
            <span id="toastMessage">Action completed successfully!</span>
        </div>
    </div>
    <div class="toast-progress"></div>
</div>

<script>
    // DOM Elements
    const addQuizBtn = document.getElementById('addQuizBtn');
    const addQuizModal = document.getElementById('addQuizModal');
    const editQuizModal = document.getElementById('editQuizModal');
    const deleteQuizModal = document.getElementById('deleteQuizModal');
    const toastNotification = document.getElementById('toastNotification');
    const addQuizForm = document.getElementById('addQuizForm');
    const editQuizForm = document.getElementById('editQuizForm');
    const deleteQuizTitle = document.getElementById('deleteQuizTitle');
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    const quizTableBody = document.getElementById('quizTableBody');
    const closeButtons = document.querySelectorAll('.close, .btn-cancel');
    const toastMessage = document.getElementById('toastMessage');
    const imagePreview = document.getElementById('imagePreview');
    const editImagePreview = document.getElementById('editImagePreview');
    const quizImage = document.getElementById('quizImage');
    const editQuizImage = document.getElementById('editQuizImage');

    // Current quiz ID to delete
    let currentQuizIdToDelete = null;

    // Quiz counter for adding new quizzes
    let quizCounter = document.querySelectorAll('#quizTableBody tr').length + 1;

    // Add Event Listeners
    addQuizBtn.addEventListener('click', openAddQuizModal);
    closeButtons.forEach(button => {
        button.addEventListener('click', closeModals);
    });

    // Image preview handlers
    quizImage.addEventListener('change', function() {
        handleImagePreview(this, imagePreview);
    });

    editQuizImage.addEventListener('change', function() {
        handleImagePreview(this, editImagePreview);
    });

    // Setup edit and delete buttons
    setupActionButtons();

    // Add Quiz Form Submit
    addQuizForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const title = document.getElementById('quizTitle').value;
        const description = document.getElementById('quizDescription').value;
        const category = document.getElementById('quizCategory').value;
        const tags = document.getElementById('quizTags').value;
        
        // Add new quiz to table
        addQuizToTable(title, description, category, tags);
        
        // Close modal and show success notification
        closeModals();
        showToast('Quiz added successfully!');
        
        // Reset form
        addQuizForm.reset();
        imagePreview.innerHTML = '';
    });

    // Edit Quiz Form Submit
    editQuizForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const id = document.getElementById('editQuizId').value;
        const title = document.getElementById('editQuizTitle').value;
        const description = document.getElementById('editQuizDescription').value;
        const category = document.getElementById('editQuizCategory').value;
        const tags = document.getElementById('editQuizTags').value;
        
        // Update quiz in table
        updateQuizInTable(id, title, description, category, tags);
        
        // Close modal and show success notification
        closeModals();
        showToast('Quiz updated successfully!');
    });

    // Confirm Delete Button
    confirmDeleteBtn.addEventListener('click', function() {
        if (currentQuizIdToDelete) {
            // Delete quiz from table
            deleteQuizFromTable(currentQuizIdToDelete);
            
            // Close modal and show success notification
            closeModals();
            showToast('Quiz deleted successfully!');
            
            currentQuizIdToDelete = null;
        }
    });

    // Functions
    function openAddQuizModal() {
        addQuizModal.classList.add('show');
    }

    function openEditQuiz(id) {
        const row = document.getElementById(`quiz-${id}`);
        const title = row.querySelector('.quiz-title').innerText;
        const description = row.querySelector('.quiz-description').innerText;
        const category = row.querySelector('.quiz-category').innerText;
        const tags = row.querySelector('.quiz-tags').innerText;

        document.getElementById('editQuizId').value = id;
        document.getElementById('editQuizTitle').value = title;
        document.getElementById('editQuizDescription').value = description;
        document.getElementById('editQuizCategory').value = category;
        document.getElementById('editQuizTags').value = tags;

        editQuizModal.classList.add('show');
    }

    function openDeleteQuiz(id) {
        currentQuizIdToDelete = id;
        const row = document.getElementById(`quiz-${id}`);
        const title = row.querySelector('.quiz-title').innerText;
        deleteQuizTitle.innerText = title;
        deleteQuizModal.classList.add('show');
    }

    function closeModals() {
        addQuizModal.classList.remove('show');
        editQuizModal.classList.remove('show');
        deleteQuizModal.classList.remove('show');
    }

    function showToast(message) {
        toastMessage.innerText = message;
        toastNotification.classList.add('show');
        setTimeout(() => {
            toastNotification.classList.remove('show');
        }, 3000);
    }

    function handleImagePreview(input, previewElement) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                previewElement.innerHTML = `<img src="${e.target.result}" alt="Image preview" class="preview-image">`;
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }

    function addQuizToTable(title, description, category, tags) {
        const row = document.createElement('tr');
        row.id = `quiz-${quizCounter}`;
        row.innerHTML = `
            <td>${quizCounter}</td>
            <td class="quiz-title">${title}</td>
            <td class="quiz-description">${description}</td>
            <td class="quiz-category">${category}</td>
            <td class="quiz-tags">${tags}</td>
            <td class="quiz-image"><img src="/api/placeholder/40/40" alt="Quiz thumbnail" class="quiz-thumbnail"></td>
            <td>${getCurrentDate()}</td>
            <td><span class="badge-updated today">Today</span></td>
            <td class="actions-cell">
                <button class="btn-edit" data-id="${quizCounter}" data-title="${title}" data-desc="${description}" data-category="${category}" data-tags="${tags}">
                    <i class="fas fa-edit"></i>Edit
                </button>
                <button class="btn-delete" data-id="${quizCounter}" data-title="${title}">Delete</button>
                <button class="btn-publish" data-id="${quizCounter}" onclick="togglePublishStatus(${quizCounter})">
                    <i class="fas fa-eye"></i>
                     <span class="publish-text">Publish</span>
                </button>
            </td>
            <td>
                <a href="/admin/quizzes/${quizCounter}/addquestion" class="btn-go">
                    <i class="fas fa-question-circle"></i>Go
                </a>
            </td>
        `;
        quizTableBody.appendChild(row);
        quizCounter++;
        setupActionButtons(); // Assign events to new buttons
    }
    
    function updateQuizInTable(id, title, description, category, tags) {
        const row = document.getElementById(`quiz-${id}`);
        if (row) {
            row.querySelector('.quiz-title').innerText = title;
            row.querySelector('.quiz-description').innerText = description;
            row.querySelector('.quiz-category').innerText = category;
            row.querySelector('.quiz-tags').innerText = tags;
            row.querySelector('.badge-updated').innerText = "Just now";
            row.querySelector('.badge-updated').className = "badge-updated today";
        }
    }
    
    function deleteQuizFromTable(id) {
        const row = document.getElementById(`quiz-${id}`);
        if (row) {
            row.remove();
        }
    }
    
    function getCurrentDate() {
        const today = new Date();
        const dd = String(today.getDate()).padStart(2, '0');
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const yy = String(today.getFullYear()).slice(2);
        return `${dd}/${mm}/${yy}`;
    }
    
    function setupActionButtons() {
        const editButtons = document.querySelectorAll('.btn-edit');
        const deleteButtons = document.querySelectorAll('.btn-delete');

        editButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const id = btn.getAttribute('data-id');
                openEditQuiz(id);
            });
        });

        deleteButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const id = btn.getAttribute('data-id');
                openDeleteQuiz(id);
            });
        });
    }
    // Global variable to store the current quiz ID for publishing/unpublishing
    let currentPublishQuizId = null;
    let isPublished = false;
    
    // Open publish/unpublish modal
    function togglePublishStatus(quizId) {
        const button = document.querySelector(`.btn-publish[data-id="${quizId}"]`);
        isPublished = button.classList.contains('published');
        
        // Update modal content based on current status
        document.getElementById('publishModalTitle').textContent = isPublished ? 'Unpublish Quiz' : 'Publish Quiz';
        document.getElementById('publishConfirmMessage').style.display = isPublished ? 'none' : 'block';
        document.getElementById('unpublishConfirmMessage').style.display = isPublished ? 'block' : 'none';
        
        // Store the quiz ID
        currentPublishQuizId = quizId;
        
        // Show modal
        document.getElementById('publishModal').classList.add('show');
        
        // Set up confirm button
        document.getElementById('confirmPublishBtn').onclick = confirmPublishChange;
    }
    
    // Close publish modal
    function closePublishModal() {
        document.getElementById('publishModal').classList.remove('show');
        currentPublishQuizId = null;
    }
    
    // Handle confirmation
    function confirmPublishChange() {
        if (currentPublishQuizId) {
            // Send AJAX request to update publish status
            fetch(`/quiz/toggle-publish/${currentPublishQuizId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ published: !isPublished })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update button appearance
                    const button = document.querySelector(`.btn-publish[data-id="${currentPublishQuizId}"]`);
                    const iconElement = button.querySelector('i');
                    const textElement = button.querySelector('.publish-text');
                    
                    if (isPublished) {
                        // Change to publish state
                        button.classList.remove('published');
                        iconElement.classList.remove('fa-eye-slash');
                        iconElement.classList.add('fa-eye');
                        textElement.textContent = 'Publish';
                    } else {
                        // Change to unpublish state
                        button.classList.add('published');
                        iconElement.classList.remove('fa-eye');
                        iconElement.classList.add('fa-eye-slash');
                        textElement.textContent = 'Unpublish';
                    }
                    
                    // Show success message
                    showToast(isPublished ? "Quiz unpublished successfully" : "Quiz published successfully");
                } else {
                    showToast("Error: " + (data.message || "Failed to update quiz status"));
                }
                
                // Close the modal
                closePublishModal();
            })
            .catch(error => {
                console.error('Error:', error);
                showToast("Error: Failed to update quiz status");
                closePublishModal();
            });
        }
    }
    
    // Toast notification function (assuming you already have this)
    function showToast(message) {
        // If you don't already have a toast function, implement one:
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas fa-check-circle"></i>
                <span class="toast-message">${message}</span>
            </div>
            <div class="toast-progress"></div>
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.classList.add('show');
        }, 100);
        
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 500);
        }, 3000);
    }
</script>